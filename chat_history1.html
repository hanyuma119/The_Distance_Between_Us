<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>聊天记录1</title>
  <style>
    :root{--bg:#eef2f7;--me:#d1e8ff;--her:#fff;--muted:#6b7280}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,'Helvetica Neue',Arial;background:var(--bg)}
    .container{max-width:720px;margin:18px auto;height:86vh;display:flex;flex-direction:column;border-radius:12px;overflow:hidden;box-shadow:0 10px 30px rgba(12,20,40,0.06)}
    .header{background:#fff;padding:12px 16px;display:flex;align-items:center;gap:12px;border-bottom:1px solid #eef2f6}
    .header .avatar{width:44px;height:44px;border-radius:8px;overflow:hidden}
    .header .avatar img{width:100%;height:100%;object-fit:cover;display:block}
    .header .meta{flex:1}
    .header h2{margin:0;font-size:16px}
    .header p{margin:0;color:var(--muted);font-size:13px}

    .chat{flex:1;overflow:auto;padding:18px;background:linear-gradient(180deg,#f7fbff,transparent)}
    .messages{display:flex;flex-direction:column;gap:12px;max-width:680px;margin:0 auto}

    .msg{display:flex;gap:10px;align-items:flex-end}
    .msg.me{justify-content:flex-end}
    .bubble{max-width:72%;padding:10px 12px;border-radius:12px;background:var(--her);box-shadow:0 1px 0 rgba(10,10,20,0.02);font-size:15px;color:#111}
    .msg.me .bubble{background:var(--me);border-bottom-right-radius:6px;border-bottom-left-radius:12px}
    .msg.you .bubble{border-bottom-left-radius:6px}

    .avatar-sm{width:36px;height:36px;border-radius:8px;overflow:hidden}
    .avatar-sm img{width:100%;height:100%;object-fit:cover;display:block}

    .bubble img{max-width:100%;height:auto;border-radius:8px;display:block;margin-top:6px}
    .time{display:block;margin-top:6px;font-size:12px;color:var(--muted)}

    .composer{padding:12px;background:#fff;border-top:1px solid #eef2f6;display:flex;gap:8px;align-items:center}
    .composer input{flex:1;padding:10px 12px;border-radius:20px;border:1px solid #e6e9ef}
    .composer button{padding:8px 12px;border-radius:12px;border:0;background:#2b7cff;color:#fff}

    @media (max-width:540px){.container{height:90vh}.bubble{font-size:15px}}
  </style>
</head>
<body>
  <div class="container" role="application">
    <div class="header">
      <div class="avatar"><img src="pics/chen_nian_avatar.jpg" alt="陈念"></div>
      <div class="meta">
        <h2>陈念</h2>
        <p>最后在线：2026-01-09</p>
      </div>
      <div class="actions"></div>
    </div>

    <div class="chat" id="chat">
      <div class="messages" id="messages"></div>
    </div>

    <div class="composer" aria-hidden="true">
      <input placeholder="" disabled>
      <button disabled>发送</button>
    </div>
  </div>

  <script>
    // messages will be loaded from chat_history1.json (editable)
    let messages = [];
    const container = document.getElementById('messages');

    function formatDate(ts){
      // 如果 ts 已经是字符串格式（如 "2024-08-28 18:20"），直接返回
      if(typeof ts === 'string') return ts;
      // 否则作为 UTC 时间处理
      const d = new Date(ts);
      return d.getUTCFullYear() + '-' + 
             String(d.getUTCMonth()+1).padStart(2,'0') + '-' + 
             String(d.getUTCDate()).padStart(2,'0') + ' ' +
             String(d.getUTCHours()).padStart(2,'0') + ':' + 
             String(d.getUTCMinutes()).padStart(2,'0');
    }

    function render(){
      container.innerHTML = '';
      messages.forEach(m=>{
        const el = document.createElement('div');
        el.className = 'msg ' + (m.who==='me'? 'me' : 'you');
        const avatarHtml = m.who==='me' ? '' : '<div class="avatar-sm"><img src="pics/chen_nian_avatar.jpg" alt="陈念"></div>';
        const bubble = document.createElement('div');
        bubble.className = 'bubble';
        bubble.innerHTML = `<div>${escapeHtml(m.text || '')}</div>` + (m.images? m.images.map(u=>`<img src="${u}" alt="image">`).join('') : '') + `<span class="time">${formatDate(m.time)}</span>`;
        if(m.who==='me'){
          el.appendChild(bubble);
        } else {
          el.innerHTML = avatarHtml;
          el.appendChild(bubble);
        }
        container.appendChild(el);
      });
      // scroll to bottom
      const chat = document.getElementById('chat');
      chat.scrollTop = chat.scrollHeight;
    }

    function escapeHtml(s){return String(s||'').replace(/[&"'<>]/g, c=>({'&':'&amp;','"':'&quot;','\'':'&#39;','<':'&lt;','>':'&gt;'})[c]);}

    // load messages from external JSON file
    fetch('chat_history1.json').then(r=>{
      if(!r.ok) throw new Error('fetch failed');
      return r.json();
    }).then(data=>{
      if(Array.isArray(data)) messages = data;
      render();
    }).catch(err=>{
      console.error('Failed to load chat.json', err);
      // fallback: show empty state
      container.innerHTML = '<p style="color:var(--muted);text-align:center">无法加载聊天记录，请检查 chat.json 是否存在且格式正确。</p>';
    });
  </script>
</body>
</html>